<include file="public:header" />
<style type="text/css">
#mall_id{
    width: 200px;
}
select[name="index"]{
    width: 40px;
}
.imageList {
    margin: 20px 0;
}
.imageList div{
    display: inline-block;
    margin: 10px;
    text-align: center;
}
</style>
<form id="info_form" action="{:U(MODULE_NAME.'/'.ACTION_NAME)}" method="post" enctype="multipart/form-data">
<div class="pad_10">
	<div class="col_tab">
		<ul class="J_tabs tab_but cu_li">
			<li class="current">{:L('article_basic')}</li>
			<li>{:L('article_seo')}</li>
		</ul>
		<div class="J_panes">
			<div class="content_list pad_10">
                <table>
                    <tr>
                        <td style="width: 80%;">
            				<table width="100%" cellspacing="0" class="table_form">
            		            <tr>
            						<th style="width: 60px;">商品名称：</th>
            						<td style="width: 680px;">
            		                    <input type="text" name="title" id="J_title" rel="title_color" class="input-text iColorPicker" size="72" value="{$info.title}" style="color:{$info.tcolor}">
            		                    <input type="hidden" value="{$info.tcolor}" name="tcolor" id="J_color">
            					        <a href="javascript:;" class="color_picker_btn"><img class="J_color_picker" data-it="J_title" data-ic="J_color" src="__STATIC__/images/color.png"></a>
            		                </td>
            					</tr>
                                <tr>
                                    <th>商品标签：</th>
                                    <td>
                                        <input type="text" name="tags" id="J_tags" class="input-text" size="65" value="{$tags}"/>
          		                        <input type="button" value="{:L('auto_get')}" id="J_gettags" name="tags_btn" class="btn"/></td>
                                </tr>
                                 <tr>
                                    <th>商品Slug：</th>
                                    <td>
                                        <input type="text" name="post_key" class="input-text" size="60" value="{$info.post_key}"/>                                        
                                    </td>
                                </tr>
                                <tr>
                                    <th>商品链接：</th>                                        
                                    <td>
                                        <input type="text" name="url" class="input-text" size="60"value="{$info.url}"/>
                                    </td>
                                </tr>                                
                                <tr>
                                    <th>商品价格：</th>
                                    <td><input type="text" name="prices" class="input-text" size="60" value="{$info.prices}"/></td>
                                </tr>
                                <tr>
                                    <th>所属商城：</th>
                                    <td>
                                        <div class="J_mall_index" data-id="{$info.mall_id}">
                                            <select class="index"></select>
                                            <select class="list" name="mall_id"></select>
                                        </div>
                                    </td>
                                </tr>
            		            <tr>
            						<th>商品图片：</th>
            						<td>        
                                        <notempty name="info['img']">
                                            <span class="attachment_icon J_attachment_icon" file-type="image" file-rel="{$info._img}">
                                            </span><br />
                                        </notempty>                                                                
                                        上传：<input type="file" name="img" class="input-text"  style="width:200px;" />
                                        &nbsp;&nbsp;<input type="text" class="input-text J_tip" placeholder="或者输入外部图片地址" name="img_url" value="{$info.img}" size="55"/>
                                    </td>
            		 			</tr>
                                 
                                                <tr>
            		 		<th> 开始时间：</th>
                                        <td><input type="text" name="start_time" id="J_start_time" class="date J_date_picker" size="20" value="{$info['start_time']}"/></td>
                                    </tr>
                                    <tr>
            		 		<th> 结束时间：</th>
                                        <td><input type="text" name="end_time" id="J_end_time" class="date J_date_picker" size="20" value="{$info['end_time']}"/></td>
                                    </tr>
                                    <tr>
                                    <th>附加图片：</th>
                                    <td> 
                                    <div class="imageList"></div>
                                    <div>
                                        上传：<input type="file" name="moreImg[]" class="input-text"  style="width:200px;" />
                                        &nbsp;&nbsp;<input type="text" class="input-text J_tip" placeholder="或者输入外部图片地址" name="moreImg[]" value="" size="55"/>
                                    </div>  <br/>
            
                                    <div class="moreImgDiv">
                                        <button id="addMoreLine">添加</button>
                                    </div>                          
                                        
                                    </td>
                                </tr>
                                    <tr>
                                    <th>物流信息：</th>
                                    <td><textarea name="delivery_info" id="delivery_info" style="width:90%;height:100px;resize:none;">{$info.delivery_info}</textarea></td>
                                    </tr>
                                    <tr>
                                    <th>位置信息：</th>
                                    <td><textarea name="location_info" id="location_info" style="width:90%;height:100px;resize:none;">{$info.location_info}</textarea></td>
                                    </tr>
                                    <tr>
                                    <th>提示：</th>
                                    <td><textarea name="tips" id="tips" style="width:90%;height:100px;resize:none;">{$info.tips}</textarea></td>
                                    </tr>
                                     <tr>
                                    <th>链接：</th>
                                    <td> 
                                     <div class="linksList"></div>
            
                                    <div class="moreLinkDiv">
                                        <button id="addMoreLink">添加</button>
                                    </div>                          
                                        
                                    </td>
                                </tr>
                                    <tr>
                                    <th>所属品牌：</th>
                                    <td>
                                        <div class="J_brand_index" data-id="{$info.brand_id}">
                                            <select class="brandlist" name="brand_id"></select>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>语言：</th>
                                    <td><select name="lang">
                                            <option value=""></option>
                                            <option value="cn" <if condition="$info['lang'] eq cn">selected="selected"</if>>中文</option>
                                            <option value="fr" <if condition="$info['lang'] eq fr">selected="selected"</if>>法语</option>
                                        </select>                                        
                                    </td>
                                </tr>
            		            <tr>
            						<td colspan="2"><textarea name="info" id="info" style="width:100%;height:350px;visibility:hidden;resize:none;">
                                            {$info.info}
                                    </textarea>
                                </td>
            					</tr>
            				</table>                        
                        </td>
                        <td valign="top">
                            <table width="100%" cellspacing="0" class="table_form inner_table">
            					<tr>
            						<td>  
                                        <div class="box">
                                            <div class="box_title">所属栏目：</div> 
                                            <div class="box_content" style="height: 250px;overflow-y: scroll;">
                                                {$cate_tree}
                                            </div> 
                                        </div>
 			                        </td>
            					</tr>
            		            <tr>
            						<td>
                                    作者：
                                        <input type="text" name="uname" class="input-text" size="28" value="{$info.uname}"/>
                                    
                                    </td>
            					</tr>
                                <tr>
                                    <td>
                                    热门：
                                    <label><input type="radio" name="is_hot" class="radio_style" value="1" <if condition="$info['is_hot'] eq 1">checked="checked"</if>/> 是</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          							<label><input type="radio" name="is_hot" class="radio_style" value="0"<if condition="$info['is_hot'] eq 0">checked="checked"</if>/>否</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                    推荐：
                                    <label><input type="radio" name="is_recommend" class="radio_style" value="1" <if condition="$info['is_recommend'] eq 1">checked="checked"</if>/> 已推荐</label>&nbsp;&nbsp;
          							<label><input type="radio" name="is_recommend" class="radio_style" value="0"<if condition="$info['is_recommend'] eq 0">checked="checked"</if>/>未推荐</label>
                                    </td>
                                </tr>
            					<tr>
            		 				<td>
                                        审核状态：
                                        <label><input type="radio" name="status" class="radio_style" value="1" <if condition="$info['status'] eq 1">checked="checked"</if>/> 已通过</label>&nbsp;&nbsp;
            							<label><input type="radio" name="status" class="radio_style" value="0" <if condition="$info['status'] eq 0">checked="checked"</if>/>未审核</label>
                                    
            						</td>
            					</tr>
                                <tr>
            		 				<td>
                                        定时发布：
                                        <input type="text" name="post_time" id="J_time_start" class="date J_date_picker" size="20" value="{$info['post_time']}"/>
            						</td>
            					</tr>
                                <tr>
            		 				<td>
                                        排序：
                                        <input type="text" name="ordid" class="input-text" size="28" value="{$info.ordid}"/>
            						</td>
            					</tr>
                                <tr>
            		 				<td>
                                        发布状态：
                                        <if condition="$info['post_time'] elt time()">
                                        已发布
                                        <else/>
                                        <span class="red">未发布</span>
                                        </if>
            						</td>
            					</tr>
                                <tr>
            		 				<td>
                                        添加时间：{$info['add_time']}
            						</td>
            					</tr>
            				</table>                        
                        </td>
                    </tr>
                </table>
			</div>
			<div class="content_list pad_10 hidden">
				<table width="100%" cellspacing="0" class="table_form">
					<tr>
						<th width="120">{:L('seo_title')}：</th>
		 				<td><input type="text" name="seo_title" id="seo_title" class="input-text" size="60" value="{$info.seo_title}"></td>
					</tr>
					<tr>
						<th>{:L('seo_keys')}：</th>
						<td><input type="text" name="seo_keys" id="seo_keys" class="input-text" size="60" value="{$info.seo_keys}"></td>
					</tr>
					<tr>
						<th>{:L('seo_desc')}：</th>
						<td><textarea name="seo_desc" id="seo_desc" cols="80" rows="8">{$info.seo_desc}</textarea></td>
					</tr>
				</table>
			</div>
        </div>
	</div>
    <include file="public:_submit" />   
</div>
<input type="hidden" name="id" id="id" value="{$info.id}" />

<if condition="$Think['request']['collect_flag'] eq 0 and isset($Think['request']['collect_flag'])">
<input type="hidden" name="collect_flag" value="1"/>
</if>
</form>
<include file="public:footer" />
<script src="__STATIC__/js/jquery/plugins/colorpicker.js"></script>
<script src="__STATIC__/js/kindeditor/kindeditor-min.js"></script>
<script>
//$('.J_cate_select').cate_select('请选择');
$(function() {
	KindEditor.create('#info', {
		uploadJson : '{:U("attachment/editer_upload")}',
		fileManagerJson : '{:U("attachment/editer_manager")}',
		allowFileManager : true,
        items:['source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'code', 'cut', 'copy', 'paste',
		'plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',
		'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript',
		'superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen',
		'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
		'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', 'image', 'multiimage', 
		'flash', 'media', 'insertfile', 'table', 'hr', 'emoticons', 'baidumap', 'pagebreak',
		'anchor', 'link', 'unlink']
	});
	$('ul.J_tabs').tabs('div.J_panes > div');
	
	//颜色选择器
	$('.J_color_picker').colorpicker();
	//自动获取标签
	$('#J_gettags').live('click', function() {
		var title = $.trim($('#J_title').val());
		if(title == ''){
			$.zhiphp.tip({content:lang.article_title_isempty, icon:'alert'});
			return false;
		}
		$.getJSON('{:U(MODULE_NAME."/ajax_gettags")}', {title:title}, function(result){
			if(result.status == 1){
				$('#J_tags').val(result.data);
			}else{
				$.zhiphp.tip({content:result.msg});
			}
		});
	});
    create_mall_index($('.J_mall_index'));
    create_brand_index($('.J_brand_index'));   
    get_support_images('.imageList',$('#id').val());
    get_support_links('.linksList',$('#id').val());

    $('#addMoreLine').click(function(event){
        event.preventDefault();
        $('.moreImgDiv').before(function(){
            return createElements();
        });

    });
    $('#addMoreLink').click(function(event){
        event.preventDefault();
        $('.moreLinkDiv').before(function(){
            return createlinkers();
        });

    });

    $('.J_link_tab').each(function(){
        $this=$(this);
        var selected=$this.attr('data-selected');
        if($.trim(selected).length==0){
            selected='taobao';
        }
        $select_item=$('.tab_menu .tab_item[data-data="'+selected+'"]',$this);
        $select_item.attr('checked','checked');
        $('.tab_content .tab_item',$this).eq($select_item.index()).show().siblings().hide();
        $('.tab_menu .tab_item',$this).click(function(){
            $('.tab_content .tab_item',$this).eq($(this).index()).show().siblings().hide();
        });         
    });    
    $('.btn_b2c').click(function(){
        var link=$.trim($('.link_b2c').val());
        if(link.length>0){
            $.get("{:U(MODULE_NAME.'/convert_link')}",{link:link},function(data){
                if(data.status==1){
                    $('.url_b2c').val(data.data);
                }
            },'json');
        }
    });    
});

function createElements()
{    
    var html = "";
    html += '<div>上传：<input type="file" name="moreImg[]" class="input-text"  style="width:200px;" />&nbsp;&nbsp; <input type="text" class="input-text J_tip" placeholder="或者输入外部图片地址" name="moreImg[]" value="" size="55"/></div><br/>';
    return html;   
}
function createlinkers()
{    
    var html = "";
    html += '<div><label>URL: </label><input type="text" name="moreLink[]" class="input-text" value="" placeholder="链接地址" /><input type="text" name="moreDes[]" class="input-text" placeholder="描述" value="" /><label> 点击数：</label><input type="text" name="moreCount[]" class="input-text" value="" style="width:20px" /></div>  <br/>';
    return html;   
}
</script>
</body>
</html>